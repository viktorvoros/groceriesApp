#:import Factory kivy.factory.Factory

<ListItemWithCounter>:
    canvas.before:
        Color:
            rgba: 1,1,1,1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [3]
            # border: [10,10,10,10]
    text: root.list_title
    color: 0, 0,0,0
    on_release:
        root.parent.parent.parent.parent.parent.edit_list(root.list_index, root.list_number, root.list_screen)
        # print(root)

    CounterLabel:
        text: root.list_number
        theme_text_color: "Custom"
        color: 0.4,0.4,0.4,1


    IconButtonRight:
        icon: 'delete'
        theme_text_color: "Custom"
        text_color: 0.4,0.4,0.4,1
        on_release:
            root.parent.parent.parent.parent.parent.del_list(root.list_index, root.list_screen)

<SwipeButton>:
    listItem:listItem
    text: ''
    color: 0, 0,0,1
    ignore_perpendicular_swipes: True
    min_move: 20/self.width
    index:1
    canvas.before:
        Color:
            rgba: 1,1,1,1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [3]
    Button:
        text: 'Done'
        color: 1,1,1,1
        background_color:(0,1,0,1) if self.state == 'normal' else (0,1,0,1)
        on_press:
            root.parent.parent.parent.parent.parent.del_item(root.list_index)
    ListItem:
        id: listItem
        text: root.list_title
        color: 0,0,0,1
        on_press:
            print(root.list_index)
            # print(root.parent.parent.parent.parent.parent)
            root.parent.parent.parent.parent.parent.item_info(root.list_index, root.list_title)

    Button:
        text: 'Delete'
        color: 1,1,1,1
        background_color:(1,0,0,1) if self.state == 'normal' else (1,0,0,1)
        on_press:
            root.parent.parent.parent.parent.parent.del_item(root.list_index)

<ListItem>:
    canvas.before:
        Color:
            rgba: 1,1,1,1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [3]
    text: ''
    color: 0, 0,0,0
    secondary_text: 'Notes'
    secondary_font_style: 'Subtitle2'
    # IconButtonLeft:
    #     icon: 'delete'
    #     on_release:
    #         root.parent.parent.parent.parent.parent.del_item(root.list_index)
    #         # app.refresh_data(root.list_index, root.parent.parent.parent.parent.parent.list_number)
    ItemCounterLabel:
        text: self.item_number
        theme_text_color: "Custom"
        text_color: 0.4,0.4,0.4,1

    # IconButtonRight:
    #     icon: 'minus'
    #     on_release:

    # ItemCounterLabel:
    #     text: self.item_number
    #     theme_text_color: "Custom"
    #     text_color: 0.4,0.4,0.4,1

    # IconButtonRight:
    #     icon: 'plus'
    #     on_release:

    IconRightWidget:
        icon: 'food'
        canvas.before:
            Color:
                rgba: 1,0,0,1
            Rectangle:
                size: self.size
                pos: self.pos
        # on_press:
        #     root.parent.parent.parent.parent.parent.parent.parent.edit_item(root.list_index)

<ItemPopup>:
    item_name:item_name
    category:category
    price:price
    id: pop
    # background_color:0, 0, 0, 0
    separator_height: 0
    # title:''
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0,0.4,0,1
            RoundedRectangle:
                size: self.size
                pos: self.pos
                radius: [16,16,16,16]
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: 60
            padding: [10,0,10,0]
            MDIconButton:
                # size_hint_x: 0.1
                # width: 30
                icon: 'keyboard-backspace'
                theme_text_color: "Custom"
                text_color: 1,1,1,1
                item_name: item_name.hint_text if item_name.hint_text != "" else item_name.text
                on_release:
                    root.caller.edit_item(item_name.text)
                    pop.dismiss()
            # Label:
            #     text: root.list_title
            #     bold: True
            #     size_hint_y: None
            #     height: 50
            MDTextField:
                id: item_name
                size_hint_y: 0.85
                hint_text: "Item"
                text: pop.list_title
                # foreground_color: (1,1,1,1)
                color_mode: "custom"
                current_hint_text_color: 1,1,1,1
                line_color_normal: 0.8,0.8,0.8,1
                line_color_focus: 1,1,1,1
                on_text_validate:
                    root.caller.edit_item(self.text)
            # TextInput:
            #     id: item_name
            #     hint_text: pop.list_title
            #     multiline: False
            #     size_hint_y: 0.8
            #     color: 1,1,1,1
            #     hint_text_color: (1,1,1,1)
            #     foreground_color: (1,1,1,1)
            #     background_normal : ''
            #     background_color: 0,0,0,0
            #     font_size: '20sp'
            #     on_text_validate:
            #         root.caller.edit_item(self.text)
            MDIconButton:
                icon: 'delete'
                theme_text_color: "Custom"
                text_color:1,1,1,1
                on_release:
                    root.caller.del_item(root.caller.item_number)
                    pop.dismiss()
        BoxLayout:
            orientation: 'vertical'
            spacing: 10
            canvas.before:
                Color:
                    rgba: 1,1,1,1
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [0,0,16,16]
            Label:
                text:''
                size_hint_y: None
                height: 10
            BoxLayout:
                orientation: 'horizontal'
                padding: [20,0,20,0]
                spacing: 10

                BoxLayout:
                    orientation: 'vertical'
                    row_default_height: 30
                    row_force_default: True

                    MDTextField:
                        id: category
                        hint_text: "Category"
                        text: 'Dairy'
                        color_mode: "custom"
                        current_hint_text_color: 0,0,0,1
                        line_color_normal: 0.4,0.4,0.4,0.5
                        line_color_focus: 0,0.4,0,1
                        on_text_validate:
                            lab.text = self.text
                            # pop.dismiss()
                            root.caller.edit_item(self.text)

                    MDTextField:
                        id: note
                        hint_text: "Quantity"
                        text: '1'
                        color_mode: "custom"
                        current_hint_text_color: 0,0,0,1
                        line_color_normal: 0.4,0.4,0.4,0.5
                        line_color_focus: 0,0.4,0,1
                        on_text_validate:
                            lab.text = self.text
                            # pop.dismiss()
                            root.caller.edit_item(self.text)
                    MDTextField:
                        id: price
                        hint_text: "Price"
                        text: '0'
                        color_mode: "custom"
                        current_hint_text_color: 0,0,0,1
                        line_color_normal: 0.4,0.4,0.4,0.5
                        line_color_focus: 0,0.4,0,1
                        on_text_validate:
                            lab.text = self.text
                            # pop.dismiss()
                            root.caller.edit_item(self.text)

                    MDTextField:
                        id: note
                        hint_text: "Note"
                        text: ''
                        color_mode: "custom"
                        current_hint_text_color: 0,0,0,1
                        line_color_normal: 0.4,0.4,0.4,0.5
                        line_color_focus: 0,0.4,0,1
                        on_text_validate:
                            lab.text = self.text
                            # pop.dismiss()
                            root.caller.edit_item(self.text)

                BoxLayout:
                    orientation: 'vertical'
                    spacing: 10
                    Label:
                        text: 'Image/icon here'
                        color: 1,1,1,1
                        canvas.before:
                            Color:
                                rgba: 0,0.4,0,1
                            Rectangle:
                                size: self.size
                                pos: self.pos
                    Button:
                        text: 'Change photo'
                        size_hint_y: 0.2
            Widget:
                size_hint_y: None
                height: 10


<ScreenManagementHome>:
    id: sm
    transition: self.transition
    HomeWindow:
    # ListWindow:

<MainWindow>:

    BoxLayout:
        orientation:'vertical'
        # MDToolbar:
        #     # title: 'My lists'
        #     md_bg_color: 0, .4, 0, 1
        #     specific_text_color: 1, 1, 1, 1
        #     size_hint_y: None
        #     height: 20

        MDBottomNavigation:
            panel_color: 1, 1, 1, 1

            MDBottomNavigationItem:
                name: 'HomeWindow'
                text: 'Home'
                icon: 'home'
                ScreenManagementHome:

            MDBottomNavigationItem:
                name: 'ChartWindow'
                text: 'Graphs'
                icon: 'chart-bar'
                ChartWindow:

            MDBottomNavigationItem:
                name: 'RecipesWindow'
                text: 'Recipes'
                icon: 'food'
                RecipesWindow:

            MDBottomNavigationItem:
                name: 'CalendarWindow'
                text: 'Calendar'
                icon: 'calendar'
                CalendarWindow:

            MDBottomNavigationItem:
                name: 'RecipesWindow'
                text: 'Settings'
                icon: 'settings'
                SettingsWindow:

<HomeWindow>:
    name: 'lists'
    # listGrid:listGrid
    list:list
    GridLayout:
        cols:1
        MDToolbar:
            title: 'My lists'
            halign: 'center'
            md_bg_color: 0, .4, 0, 1
            specific_text_color: 1, 1, 1, 1
        Label:
            text:''
            size_hint_y: None
            height: 10
        GridLayout:
            cols: 1
            padding: 10,0,10,0
            GridLayout:
                cols: 2
                size_hint_y: None
                height: 60
                row_default_height: 60
                row_force_default: True
                padding: 0,0,30,0
                canvas:
                    Color:
                        rgba: 0,0.4,0,1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [3]
                MDIconButton:
                    icon: "plus"
                    pos_hint: {"center_x": .5, "center_y": .5}
                    valign: 'center'
                    theme_text_color: "Custom"
                    text_color: 1,1,1,1
                    on_release:
                        root.add_list(list.text, '0', '0')
                        root.clearTxt(list.text)
                        root.save_lists()

                MDTextField:
                    id: listText
                    hint_text: "New list..."
                    color_mode: "custom"
                    current_hint_text_color: 1,1,1,1
                    line_color_normal: 0.8,0.8,0.8,1
                    line_color_focus: 1,1,1,1
                    id: list
                    on_text_validate:
                        root.add_list(self.text, '0', '0')
                        root.clearTxt(self.text)
                        root.save_lists()

            MDLabel:
                text: ''
                size_hint_y: None
                height: 10

            RecycleView:
                data: root.data_for_widgets
                viewclass: 'ListItemWithCounter'
                do_scroll_x: False
                do_scroll_y: True

                RecycleBoxLayout:
                    default_size: None, dp(56)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: 'vertical'
                    spacing: dp(2)

<ListWindow>:
    on_list_content: app.set_list_content(self.list_index, self.list_content)
    on_list_title: app.set_list_title(self.list_index, self.list_title)

    item:item
    listGrid:listGrid
    tb:tb
    lineChart:lineChart

    GridLayout:
        id:listGrid
        cols:1
        GridLayout:
            cols: 2
            padding: 10,0,10,0
            size_hint_y: None
            height: 60
            canvas.before:
                Color:
                    rgba: 0, 0.4, 0, 1
                Rectangle:
                    size: self.size
                    pos: self.pos
            MDIconButton:
                icon: "keyboard-backspace"
                valign: 'middle'
                # size_hint_x: 0.2s
                # pos_hint: {"center_x": .5, "center_y": .5}
                theme_text_color: "Custom"
                text_color: 1,1,1,1
                md_bg_color: 0, 0.4, 0, 1
                on_release:
                    self.parent.parent.parent.parent.go_lists()
                    app.refresh_data(root.list_index, root.list_number)
                    # root.empty_list()
                    # root.refresh_data(root.list_index, root.list_number)
                    root.save_items()
            MDLabel:
                # size_hint_x: 0.8
                id: tb
                text: root.list_title
                color: 1,1,1,1
                font_size: "20sp"
                bold: True

        MDLabel:
            # text: root.list_number
            color: 1,0,1,1
            size_hint_y: None
            height: 10
        GridLayout:
            cols:1
            padding: 10, 0, 10, 0
            GridLayout:
                cols: 2
                padding: 0,0,30,0
                size_hint_y: None
                height: 60
                row_default_height: 60
                row_force_default: True
                canvas.before:
                    Color:
                        rgba: 0,0.4,0,1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [3]

                MDIconButton:
                    icon: "plus"
                    pos_hint: {"center_x": .5, "center_y": .5}
                    theme_text_color: "Custom"
                    text_color: 1,1,1,1
                    on_release:
                        root.add_item(item.text)
                        root.clearTxt(item.text)
                        root.save_items()
                MDTextField:
                    id: item
                    hint_text: "New item..."
                    color_mode: "custom"
                    current_hint_text_color: 1,1,1,1
                    line_color_normal: 0.8,0.8,0.8,1
                    line_color_focus: 1,1,1,1
                    # id: item
                    on_text_validate:
                        root.add_item(item.text)
                        root.clearTxt(item.text)
                        root.save_items()
            MDLabel:
                text: ''
                size_hint_y: None
                height: 10

            BoxLayout:
                id: lineChart
                orientation: 'horizontal'
                size_hint_y: None
                height: 10
                Label:
                    size_hint_x: 0.25
                    canvas.before:
                        Color:
                            rgba: 1,0,0,1
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    size_hint_x: 0.25
                    canvas.before:
                        Color:
                            rgba: 0,1,0,1
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    size_hint_x: 0.25
                    canvas.before:
                        Color:
                            rgba: 0,0,1,1
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    size_hint_x: 0.25
                    canvas.before:
                        Color:
                            rgba: 1,1,0,1
                        Rectangle:
                            size: self.size
                            pos: self.pos
            RecycleView:
                data: root.data_for_items
                viewclass: 'SwipeButton'
                do_scroll_x: False
                do_scroll_y: True
                RecycleBoxLayout:
                    default_size: None, dp(56)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: 'vertical'
                    spacing: dp(2)

<ChartWindow>:
    # name: 'ChartWindow'
    GridLayout:
        cols: 1
        MDToolbar:
            title: 'My graphs'
            halign: 'center'
            md_bg_color: 0, .4, 0, 1
            specific_text_color: 1, 1, 1, 1
        MDLabel:
            text:"make graphs here about payment and nutrition"
            halign:'center'

<CalendarWindow>:
    name:'CalendarWindow'
    box:box
    GridLayout:
        name:'box'
        id:box
        cols:1
